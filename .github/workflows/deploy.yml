# name: Build and Deploy

# on:
#   push:
#     branches:
#       - main
#   workflow_dispatch:

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest
#     permissions:
#       contents: write

#     steps:
#       - name: Checkout Source
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '20'
#           cache: 'npm'

#       - name: Install Dependencies
#         run: npm ci

#       - name: Build Application
#         run: npm run build -- --configuration production

#       - name: Deploy to External Repository
#         env:
#           API_TOKEN_GITHUB: ${{ secrets.API_TOKEN_GITHUB }}
#           TARGET_REPO: 'Gahranox-Carvel-Labs/gahranox-carvel-labs.github.io'
#           TARGET_BRANCH: 'main'
#         run: |
#           if [ -z "$API_TOKEN_GITHUB" ]; then
#             echo "Error: API_TOKEN_GITHUB secret is missing."
#             exit 1
#           fi

#           echo "Cloning target repository..."
#           git clone https://x-access-token:$API_TOKEN_GITHUB@github.com/$TARGET_REPO.git target_repo
          
#           echo "Preparing target directory..."
#           cd target_repo
#           git checkout $TARGET_BRANCH || git checkout -b $TARGET_BRANCH
          
#           # Clean existing files (excluding .git)
#           find . -maxdepth 1 ! -name '.git' ! -name '.' ! -name '..' -exec rm -rf {} +
          
#           echo "Copying build artifacts..."
#           # Note: Angular 'application' builder outputs to dist/project-name/browser
#           # Adjust if your build path is different
#           cp -r ../dist/gahranox-website/browser/* .
          
#           echo "Committing and Pushing..."
#           git config user.name "GitHub Actions Bot"
#           git config user.email "actions@github.com"
          
#           git add .
#           # Commit only if there are changes
#           git diff-index --quiet HEAD || git commit -m "Deploy from Lander commit $GITHUB_SHA"
          
#           git push origin $TARGET_BRANCH
